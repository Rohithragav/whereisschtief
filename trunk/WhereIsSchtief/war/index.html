<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Where is Schtief</title>
    <script src="prototype.js" type="text/javascript"></script>
    <script src="calendar_date_select.js" type="text/javascript"></script>
    <script src="format_finnish.js" type="text/javascript"></script>
	<link href="silver.css" media="screen" rel="stylesheet" type="text/css" />
	
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAd1mTWhhIf0BDdkWVS78vshQ8O2Rrwn_syHWXxA1_wLHAaTolExSVr1TGtIN58GjZWjW31betl2bmZw"
      type="text/javascript"></script>
    <script type="text/javascript">
var map;
var latestPos;
var entries;
var error="";
function load() {
	if (!GBrowserIsCompatible()) {
		document.getElementById("error").innerHTML = "Not compatible!";
		return;
	}

	map = new GMap2(document.getElementById("map"));
	map.addControl(new GSmallMapControl());
	//map.addControl(new GMapTypeControl()); 

	update();
}

function update(){
	map.clearOverlays();
	latestPos=null;
	for (var i = 0; i < entries.length; i++) {
		try{
			var entry = entries[i];
			var info = entry['info'];
			var type = entry['type'];
			var lon =  entry['latitude'];	
			var lat =  entry['longitude'];
				if(null==latestPos){

				}
				else{
					var polyline = new GPolyline([latestPos,new GLatLng(lat, lon)], "#aa0000", 5);
					map.addOverlay(polyline);
				}
				latestPos = new GLatLng(lat, lon);
				map.addOverlay(createMarker(latestPos, info, type, i));  
		}catch(e){
			error += e.name+" : "+ e.message;
			document.getElementById("error").innerHTML =error;
		}
		map.setCenter(latestPos, 12);
	}
}

function createMarker(point, info, type, id ) {
	id=id+1;
	var icon;

	if(type=="location")
		icon = new GIcon(G_DEFAULT_ICON,"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+id+"|ff2222|000000"); 

	if(type=="cluster")
		icon = new GIcon(G_DEFAULT_ICON,"http://chart.apis.google.com/chart?chst=d_map_pin_icon&chld=home|FFFF00");

	if(type=="actual")
		icon = new GIcon(G_DEFAULT_ICON,"http://chart.apis.google.com/chart?chst=d_map_xpin_icon&chld=pin_star|home|00FFFF|FF0000");
	
	var marker = new GMarker(point, {icon:icon, zIndexProcess:orderOfCreation});
	GEvent.addListener(marker, "mouseover", function() {
		marker.openInfoWindowHtml("<b>" + info + "</b>");
	});    
  	return marker;
}

      function orderOfCreation(marker,b) { 
        return 1; 
      } 
      
function setUserDate(){
	new Ajax.Request('/whereisschtief', {
	  method: 'get',
	  parameters: {action: 'getdata', callback: 'updateLocations', date: document.forms[0].date.value, name: document.forms[0].user.value}
	  });
}
   
function updateLocations(root){
	entries = root.locations || [];
	update();
} 
    
function listLocations(root) {
	entries = root.locations || [];
}
    </script>
  </head>
  <body onload="load()" onunload="GUnload()">
  <center>
  <form><b>User:</b><select id="user" name="user" ><option selected>schtief</option><option>fritz</option><option>martin</option></select>
  <input id="date" name="date" type="text" value="" onChange="setUserDate()" /><img alt="Calendar" onclick="new CalendarDateSelect( $(this).previous(), {year_range:10} );" src="calendar.gif" style="border:0px; cursor:pointer;" /><b>&lt;-- Where was Schtief on (click on Calendar icon!)</b></form>
  <div id="map" style="width:600px;height:400px"></div>
  <div id="error"></div> 
  </center>
  TODOS:<br/>
  <ul><li><strike>Clustering: Verweildauer an den Orten aufsummieren </strike></li>
  <li>Integration von Twitter/Flickr und evtl. meiner Anrufdaten</li>
  <li>Ungewoehnliche Orte herausfilter und extra anzeigen.<br/>(Treffen mit Terroristen/Urlaub in Pakistan)</li>
  <li><strike>Multiusererweiterung</strike> & Community :-)</li>
  </ul>
  
<script src="/whereisschtief?action=getdata&callback=listLocations&name=schtief">
</script>
  <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-5877296-7");
pageTracker._trackPageview();
} catch(err) {}</script></body>
</html>