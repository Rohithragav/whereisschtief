<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Where is Schtief</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAd1mTWhhIf0BDdkWVS78vshRSTg9wWT0eW80BXiutWhF4xmufRRTGEicBumUxzLYXhm5Cwj0j35i6gQ"
      type="text/javascript"></script>
    <script type="text/javascript">
var map;
var latestPos;
var entries;
var error="";
function load() {
	if (!GBrowserIsCompatible()) {
		document.getElementById("error").innerHTML = "Not compatible!";
		return;
	}

	map = new GMap2(document.getElementById("map"));
	map.addControl(new GSmallMapControl());
	map.addControl(new GMapTypeControl()); 

	latestPos=null;
	var setCenter=false;
	for (var i = 0; i < entries.length; i++) {
		try{
			var entry = entries[i];
			var title = entry['date'];
			//var start =  entry['gsx$date'].$t;	
			//var status =  entry['gsx$status'].$t;	
			var lon =  entry['latitude'];	
			var lat =  entry['longitude'];
			//if(status=='update' && ''!=lat && ''!=lon){
				lat=lat;
				lon=lon;
				if(null==latestPos){
					if(false==setCenter){
						map.setCenter(new GLatLng(lat, lon), 15);
						setCenter=true;
					}
				}else{
					var polyline = new GPolyline([latestPos,new GLatLng(lat, lon)], "#aa0000", 5);
					map.addOverlay(polyline);
				}
				latestPos = new GLatLng(lat, lon);
				map.addOverlay(createMarker(latestPos, title));  
//			}else{
//				latestPos=null;
//			}
		}catch(e){
			error += e.name+" : "+ e.message;
			document.getElementById("error").innerHTML =error;
		}

	}
	
	if(false==setCenter){
		map.setCenter(new GLatLng(52.519227, 13.318927), 10);
	}
}

function createMarker(point, name) {
	var marker = new GMarker(point);
	GEvent.addListener(marker, "mouseover", function() {
		marker.openInfoWindowHtml("<b> " + name + " </b>");
	});    
  return marker;
}
    
function listLocations(root) {
	entries = root.locations || [];
}
    </script>
  </head>
  <body onload="load()" onunload="GUnload()">
  
  <center>
  <h1>Where is Schtief</h1> 
    <div id="map" style="width:700px;height:400px"></div>
  <div id="status"></div> 
  <div id="error"></div> 
  </center>
  
<script src="http://whereisschtief.appspot.com/whereisschtief?action=getdata&callback=listLocations">
</script>
  </body>
</html>